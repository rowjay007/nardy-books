{"version":3,"file":"genreController.js","sources":["controllers/genreController.ts"],"sourceRoot":"/","sourcesContent":["import { Request, Response, NextFunction } from \"express\";\nimport * as GenreService from \"../services/genreService\";\nimport catchAsync from \"../utils/catchAsync\";\nimport AppError from \"../utils/appError\";\nimport { Types } from \"mongoose\";\n\n/**\n * Converts a string to a Mongoose ObjectId.\n * @param {string} id - The ID to convert.\n * @returns {Types.ObjectId} - The converted ObjectId.\n * @throws {AppError} - Throws an error if the ID format is invalid.\n */\nconst convertToObjectId = (id: string): Types.ObjectId => {\n  try {\n    return new Types.ObjectId(id);\n  } catch (error) {\n    throw new AppError(\"Invalid ID format\", 400);\n  }\n};\n\n/**\n * Controller function to create a genre\n * @param {Request} req - Express request object with body containing genre data\n * @param {Response} res - Express response object\n * @param {NextFunction} next - Express next function\n * @returns {Promise<void>} - Returns a JSON object with the created genre data\n */\nexport const createGenre = catchAsync(\n  async (req: Request, res: Response, next: NextFunction) => {\n    const genre = await GenreService.createGenre(req.body);\n    res.status(201).json({\n      status: \"success\",\n      data: {\n        genre,\n      },\n    });\n  }\n);\n\n/**\n * Controller function to get a genre by ID\n * @param {Request} req - Express request object with params containing genre ID\n * @param {Response} res - Express response object\n * @param {NextFunction} next - Express next function\n * @returns {Promise<void>} - Returns a JSON object with the genre data\n */\nexport const getGenreById = catchAsync(\n  async (req: Request, res: Response, next: NextFunction) => {\n    const genreId = convertToObjectId(req.params.id);\n    const genre = await GenreService.getGenreById(genreId);\n    if (!genre) {\n      return next(new AppError(\"No genre found with that ID\", 404));\n    }\n    res.status(200).json({\n      status: \"success\",\n      data: {\n        genre,\n      },\n    });\n  }\n);\n\n/**\n * Controller function to get all genres\n * @param {Request} req - Express request object with query parameters for filtering, sorting, and pagination\n * @param {Response} res - Express response object\n * @param {NextFunction} next - Express next function\n * @returns {Promise<void>} - Returns a JSON object with the genres data\n */\nexport const getAllGenres = catchAsync(\n  async (req: Request, res: Response, next: NextFunction) => {\n    const sortQuery = req.query.sort as\n      | string\n      | Record<string, number>\n      | null\n      | undefined;\n\n    const genres = await GenreService.getAllGenres(\n      req.query.filter as Record<string, any>,\n      Number(req.query.page),\n      Number(req.query.limit),\n      sortQuery\n    );\n    res.status(200).json({\n      status: \"success\",\n      data: {\n        genres,\n      },\n    });\n  }\n);\n\n/**\n * Controller function to update a genre by ID\n * @param {Request} req - Express request object with params containing genre ID and body containing update data\n * @param {Response} res - Express response object\n * @param {NextFunction} next - Express next function\n * @returns {Promise<void>} - Returns a JSON object with the updated genre data\n */\nexport const updateGenreById = catchAsync(\n  async (req: Request, res: Response, next: NextFunction) => {\n    const genreId = convertToObjectId(req.params.id);\n    const genre = await GenreService.updateGenreById(genreId, req.body);\n    if (!genre) {\n      return next(new AppError(\"No genre found with that ID\", 404));\n    }\n    res.status(200).json({\n      status: \"success\",\n      data: {\n        genre,\n      },\n    });\n  }\n);\n\n/**\n * Controller function to delete a genre by ID\n * @param {Request} req - Express request object with params containing genre ID\n * @param {Response} res - Express response object\n * @param {NextFunction} next - Express next function\n * @returns {Promise<void>} - Returns a JSON object indicating successful deletion\n */\nexport const deleteGenreById = catchAsync(\n  async (req: Request, res: Response, next: NextFunction) => {\n    const genreId = convertToObjectId(req.params.id);\n    const genre = await GenreService.deleteGenreById(genreId);\n    if (!genre) {\n      return next(new AppError(\"No genre found with that ID\", 404));\n    }\n    res.status(200).json({\n      status: \"success\",\n      message: \"Genre successfully deleted\",\n      data: null,\n    });\n  }\n);\n\n/**\n * Controller function to add a book to a genre\n * @param {Request} req - Express request object with params containing genre ID and book ID\n * @param {Response} res - Express response object\n * @param {NextFunction} next - Express next function\n * @returns {Promise<void>} - Returns a JSON object with the updated genre data\n */\nexport const addBookToGenre = catchAsync(\n  async (req: Request, res: Response, next: NextFunction) => {\n    const { genreId, bookId } = req.params;\n    const genre = await GenreService.addBookToGenre(\n      convertToObjectId(genreId),\n      convertToObjectId(bookId)\n    );\n    if (!genre) {\n      return next(new AppError(\"No genre found with that ID\", 404));\n    }\n    res.status(200).json({\n      status: \"success\",\n      data: {\n        genre,\n      },\n    });\n  }\n);\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,uEAAyD;AACzD,qEAA6C;AAC7C,iEAAyC;AACzC,uCAAiC;AAEjC;;;;;GAKG;AACH,MAAM,iBAAiB,GAAG,CAAC,EAAU,EAAkB,EAAE;IACvD,IAAI,CAAC;QACH,OAAO,IAAI,gBAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IAChC,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,MAAM,IAAI,kBAAQ,CAAC,mBAAmB,EAAE,GAAG,CAAC,CAAC;IAC/C,CAAC;AACH,CAAC,CAAC;AAEF;;;;;;GAMG;AACU,QAAA,WAAW,GAAG,IAAA,oBAAU,EACnC,CAAO,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;IACxD,MAAM,KAAK,GAAG,MAAM,YAAY,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IACvD,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;QACnB,MAAM,EAAE,SAAS;QACjB,IAAI,EAAE;YACJ,KAAK;SACN;KACF,CAAC,CAAC;AACL,CAAC,CAAA,CACF,CAAC;AAEF;;;;;;GAMG;AACU,QAAA,YAAY,GAAG,IAAA,oBAAU,EACpC,CAAO,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;IACxD,MAAM,OAAO,GAAG,iBAAiB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IACjD,MAAM,KAAK,GAAG,MAAM,YAAY,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;IACvD,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,OAAO,IAAI,CAAC,IAAI,kBAAQ,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC,CAAC;IAChE,CAAC;IACD,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;QACnB,MAAM,EAAE,SAAS;QACjB,IAAI,EAAE;YACJ,KAAK;SACN;KACF,CAAC,CAAC;AACL,CAAC,CAAA,CACF,CAAC;AAEF;;;;;;GAMG;AACU,QAAA,YAAY,GAAG,IAAA,oBAAU,EACpC,CAAO,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;IACxD,MAAM,SAAS,GAAG,GAAG,CAAC,KAAK,CAAC,IAIf,CAAC;IAEd,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,YAAY,CAC5C,GAAG,CAAC,KAAK,CAAC,MAA6B,EACvC,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,EACtB,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,EACvB,SAAS,CACV,CAAC;IACF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;QACnB,MAAM,EAAE,SAAS;QACjB,IAAI,EAAE;YACJ,MAAM;SACP;KACF,CAAC,CAAC;AACL,CAAC,CAAA,CACF,CAAC;AAEF;;;;;;GAMG;AACU,QAAA,eAAe,GAAG,IAAA,oBAAU,EACvC,CAAO,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;IACxD,MAAM,OAAO,GAAG,iBAAiB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IACjD,MAAM,KAAK,GAAG,MAAM,YAAY,CAAC,eAAe,CAAC,OAAO,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC;IACpE,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,OAAO,IAAI,CAAC,IAAI,kBAAQ,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC,CAAC;IAChE,CAAC;IACD,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;QACnB,MAAM,EAAE,SAAS;QACjB,IAAI,EAAE;YACJ,KAAK;SACN;KACF,CAAC,CAAC;AACL,CAAC,CAAA,CACF,CAAC;AAEF;;;;;;GAMG;AACU,QAAA,eAAe,GAAG,IAAA,oBAAU,EACvC,CAAO,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;IACxD,MAAM,OAAO,GAAG,iBAAiB,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IACjD,MAAM,KAAK,GAAG,MAAM,YAAY,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;IAC1D,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,OAAO,IAAI,CAAC,IAAI,kBAAQ,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC,CAAC;IAChE,CAAC;IACD,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;QACnB,MAAM,EAAE,SAAS;QACjB,OAAO,EAAE,4BAA4B;QACrC,IAAI,EAAE,IAAI;KACX,CAAC,CAAC;AACL,CAAC,CAAA,CACF,CAAC;AAEF;;;;;;GAMG;AACU,QAAA,cAAc,GAAG,IAAA,oBAAU,EACtC,CAAO,GAAY,EAAE,GAAa,EAAE,IAAkB,EAAE,EAAE;IACxD,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC;IACvC,MAAM,KAAK,GAAG,MAAM,YAAY,CAAC,cAAc,CAC7C,iBAAiB,CAAC,OAAO,CAAC,EAC1B,iBAAiB,CAAC,MAAM,CAAC,CAC1B,CAAC;IACF,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,OAAO,IAAI,CAAC,IAAI,kBAAQ,CAAC,6BAA6B,EAAE,GAAG,CAAC,CAAC,CAAC;IAChE,CAAC;IACD,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;QACnB,MAAM,EAAE,SAAS;QACjB,IAAI,EAAE;YACJ,KAAK;SACN;KACF,CAAC,CAAC;AACL,CAAC,CAAA,CACF,CAAC","debug_id":"6097eb92-ba87-5c1c-b48c-22d35afe36c6"}