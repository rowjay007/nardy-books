{"version":3,"file":"app.js","sources":["app.ts"],"sourceRoot":"/","sourcesContent":["import express from \"express\";\nimport compression from \"compression\";\nimport cookieParser from \"cookie-parser\";\nimport cors from \"cors\";\nimport mongoSanitize from \"express-mongo-sanitize\";\nimport helmet from \"helmet\";\nimport hpp from \"hpp\";\nimport httpStatus from \"http-status\";\nimport morgan from \"morgan\";\nimport Sentry from \"./config/sentry\";\nimport limiter from \"./config/rateLimiter\";\nimport errorMiddleware from \"./middlewares/errorMiddleware\";\nimport router from \"./routes\";\nimport AppError from \"./utils/appError\";\n\nconst app = express();\n\nconst corsOptions = {\n  origin: [\"http://example.com\", \"http://www.example.com\"],\n  methods: [\"GET\", \"POST\", \"PUT\", \"DELETE\"],\n  allowedHeaders: [\"Content-Type\", \"Authorization\"],\n  credentials: true,\n};\n\nSentry.setupExpressErrorHandler(app);\n\napp.use(morgan(\"dev\"));\napp.use(helmet());\napp.use(cors(corsOptions));\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(compression());\napp.use(mongoSanitize());\napp.use(hpp());\n\napp.use(\n  helmet.contentSecurityPolicy({\n    directives: {\n      defaultSrc: [\"'self'\"],\n      scriptSrc: [\"'self'\", \"https://cdnjs.cloudflare.com\"],\n      styleSrc: [\"'self'\", \"https://cdnjs.cloudflare.com\"],\n      imgSrc: [\"'self'\", \"data:\"],\n      connectSrc: [\"'self'\"],\n      fontSrc: [\"'self'\", \"https://cdnjs.cloudflare.com\"],\n      objectSrc: [\"'none'\"],\n      upgradeInsecureRequests: [],\n    },\n  })\n);\n\napp.use(limiter);\n\napp.use(router);\n\napp.get(\"/debug-sentry\", function mainHandler(req, res) {\n  throw new Error(\"Nardy Book Sentry error!\");\n});\n\napp.all(\"*\", (req, res, next) => {\n  next(\n    new AppError(\n      `Can't find ${req.originalUrl} on this server!`,\n      httpStatus.NOT_FOUND\n    )\n  );\n});\n\napp.use(errorMiddleware);\n\nexport default app;\n"],"names":[],"mappings":";;;;;;;AAAA,sDAA8B;AAC9B,8DAAsC;AACtC,kEAAyC;AACzC,gDAAwB;AACxB,oFAAmD;AACnD,oDAA4B;AAC5B,8CAAsB;AACtB,8DAAqC;AACrC,oDAA4B;AAC5B,6DAAqC;AACrC,uEAA2C;AAC3C,oFAA4D;AAC5D,sDAA8B;AAC9B,gEAAwC;AAExC,MAAM,GAAG,GAAG,IAAA,iBAAO,GAAE,CAAC;AAEtB,MAAM,WAAW,GAAG;IAClB,MAAM,EAAE,CAAC,oBAAoB,EAAE,wBAAwB,CAAC;IACxD,OAAO,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,CAAC;IACzC,cAAc,EAAE,CAAC,cAAc,EAAE,eAAe,CAAC;IACjD,WAAW,EAAE,IAAI;CAClB,CAAC;AAEF,gBAAM,CAAC,wBAAwB,CAAC,GAAG,CAAC,CAAC;AAErC,GAAG,CAAC,GAAG,CAAC,IAAA,gBAAM,EAAC,KAAK,CAAC,CAAC,CAAC;AACvB,GAAG,CAAC,GAAG,CAAC,IAAA,gBAAM,GAAE,CAAC,CAAC;AAClB,GAAG,CAAC,GAAG,CAAC,IAAA,cAAI,EAAC,WAAW,CAAC,CAAC,CAAC;AAC3B,GAAG,CAAC,GAAG,CAAC,iBAAO,CAAC,IAAI,EAAE,CAAC,CAAC;AACxB,GAAG,CAAC,GAAG,CAAC,iBAAO,CAAC,UAAU,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;AACjD,GAAG,CAAC,GAAG,CAAC,IAAA,uBAAY,GAAE,CAAC,CAAC;AACxB,GAAG,CAAC,GAAG,CAAC,IAAA,qBAAW,GAAE,CAAC,CAAC;AACvB,GAAG,CAAC,GAAG,CAAC,IAAA,gCAAa,GAAE,CAAC,CAAC;AACzB,GAAG,CAAC,GAAG,CAAC,IAAA,aAAG,GAAE,CAAC,CAAC;AAEf,GAAG,CAAC,GAAG,CACL,gBAAM,CAAC,qBAAqB,CAAC;IAC3B,UAAU,EAAE;QACV,UAAU,EAAE,CAAC,QAAQ,CAAC;QACtB,SAAS,EAAE,CAAC,QAAQ,EAAE,8BAA8B,CAAC;QACrD,QAAQ,EAAE,CAAC,QAAQ,EAAE,8BAA8B,CAAC;QACpD,MAAM,EAAE,CAAC,QAAQ,EAAE,OAAO,CAAC;QAC3B,UAAU,EAAE,CAAC,QAAQ,CAAC;QACtB,OAAO,EAAE,CAAC,QAAQ,EAAE,8BAA8B,CAAC;QACnD,SAAS,EAAE,CAAC,QAAQ,CAAC;QACrB,uBAAuB,EAAE,EAAE;KAC5B;CACF,CAAC,CACH,CAAC;AAEF,GAAG,CAAC,GAAG,CAAC,qBAAO,CAAC,CAAC;AAEjB,GAAG,CAAC,GAAG,CAAC,gBAAM,CAAC,CAAC;AAEhB,GAAG,CAAC,GAAG,CAAC,eAAe,EAAE,SAAS,WAAW,CAAC,GAAG,EAAE,GAAG;IACpD,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;AAC9C,CAAC,CAAC,CAAC;AAEH,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE;IAC9B,IAAI,CACF,IAAI,kBAAQ,CACV,cAAc,GAAG,CAAC,WAAW,kBAAkB,EAC/C,qBAAU,CAAC,SAAS,CACrB,CACF,CAAC;AACJ,CAAC,CAAC,CAAC;AAEH,GAAG,CAAC,GAAG,CAAC,yBAAe,CAAC,CAAC;AAEzB,kBAAe,GAAG,CAAC","debug_id":"660efdb0-69d7-5035-afb2-82ff40de79b1"}