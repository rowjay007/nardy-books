{"version":3,"file":"genreService.js","sources":["services/genreService.ts"],"sourceRoot":"/","sourcesContent":["import { Types } from \"mongoose\";\nimport { IGenre } from \"../models/genreModel\";\nimport * as GenreRepository from \"../repositories/genreRepository\";\nimport cache, { CACHE_TTL_SECONDS } from \"../utils/cache\";\n\nexport const createGenre = async (genreData: Partial<IGenre>) => {\n  const genre = await GenreRepository.createGenre(genreData);\n  cache.flushAll(); \n  \n  return genre;\n};\n\nexport const getGenreById = async (id: Types.ObjectId) => {\n  const cacheKey = `genre_${id}`;\n  let genre: IGenre | undefined = cache.get<IGenre>(cacheKey);\n\n  if (!genre) {\n    const genreFromDb = await GenreRepository.getGenreById(id);\n    if (genreFromDb) {\n      genre = genreFromDb;\n      cache.set(cacheKey, genre, CACHE_TTL_SECONDS);\n    }\n  }\n\n  return genre;\n};\n\nexport const getAllGenres = async (\n  filter: Record<string, any>,\n  page: number,\n  limit: number,\n  sort: string | Record<string, number> | null | undefined\n) => {\n  const cacheKey = `genres_${JSON.stringify(\n    filter\n  )}_${page}_${limit}_${JSON.stringify(sort)}`;\n  let genres: IGenre[] | undefined = cache.get<IGenre[]>(cacheKey);\n\n  if (!genres) {\n    genres = await GenreRepository.getAllGenres(filter, page, limit, sort);\n    if (genres) {\n      cache.set(cacheKey, genres, CACHE_TTL_SECONDS);\n    }\n  }\n\n  return genres;\n};\n\nexport const updateGenreById = async (\n  id: Types.ObjectId,\n  updateData: Partial<IGenre>\n) => {\n  const genre = await GenreRepository.updateGenreById(id, updateData);\n  if (genre) {\n    cache.flushAll(); \n    \n  }\n  return genre;\n};\n\nexport const deleteGenreById = async (id: Types.ObjectId) => {\n  const genre = await GenreRepository.deleteGenreById(id);\n  if (genre) {\n    cache.flushAll(); \n    \n  }\n  return genre;\n};\n\nexport const addBookToGenre = async (\n  genreId: Types.ObjectId,\n  bookId: Types.ObjectId\n) => {\n  const genre = await GenreRepository.addBookToGenre(genreId, bookId);\n  if (genre) {\n    cache.flushAll(); \n    \n  }\n  return genre;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,iFAAmE;AACnE,wDAA0D;AAEnD,MAAM,WAAW,GAAG,CAAO,SAA0B,EAAE,EAAE;IAC9D,MAAM,KAAK,GAAG,MAAM,eAAe,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;IAC3D,eAAK,CAAC,QAAQ,EAAE,CAAC;IAEjB,OAAO,KAAK,CAAC;AACf,CAAC,CAAA,CAAC;AALW,QAAA,WAAW,eAKtB;AAEK,MAAM,YAAY,GAAG,CAAO,EAAkB,EAAE,EAAE;IACvD,MAAM,QAAQ,GAAG,SAAS,EAAE,EAAE,CAAC;IAC/B,IAAI,KAAK,GAAuB,eAAK,CAAC,GAAG,CAAS,QAAQ,CAAC,CAAC;IAE5D,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,MAAM,WAAW,GAAG,MAAM,eAAe,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC;QAC3D,IAAI,WAAW,EAAE,CAAC;YAChB,KAAK,GAAG,WAAW,CAAC;YACpB,eAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,KAAK,EAAE,yBAAiB,CAAC,CAAC;QAChD,CAAC;IACH,CAAC;IAED,OAAO,KAAK,CAAC;AACf,CAAC,CAAA,CAAC;AAbW,QAAA,YAAY,gBAavB;AAEK,MAAM,YAAY,GAAG,CAC1B,MAA2B,EAC3B,IAAY,EACZ,KAAa,EACb,IAAwD,EACxD,EAAE;IACF,MAAM,QAAQ,GAAG,UAAU,IAAI,CAAC,SAAS,CACvC,MAAM,CACP,IAAI,IAAI,IAAI,KAAK,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC;IAC7C,IAAI,MAAM,GAAyB,eAAK,CAAC,GAAG,CAAW,QAAQ,CAAC,CAAC;IAEjE,IAAI,CAAC,MAAM,EAAE,CAAC;QACZ,MAAM,GAAG,MAAM,eAAe,CAAC,YAAY,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QACvE,IAAI,MAAM,EAAE,CAAC;YACX,eAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,EAAE,yBAAiB,CAAC,CAAC;QACjD,CAAC;IACH,CAAC;IAED,OAAO,MAAM,CAAC;AAChB,CAAC,CAAA,CAAC;AAnBW,QAAA,YAAY,gBAmBvB;AAEK,MAAM,eAAe,GAAG,CAC7B,EAAkB,EAClB,UAA2B,EAC3B,EAAE;IACF,MAAM,KAAK,GAAG,MAAM,eAAe,CAAC,eAAe,CAAC,EAAE,EAAE,UAAU,CAAC,CAAC;IACpE,IAAI,KAAK,EAAE,CAAC;QACV,eAAK,CAAC,QAAQ,EAAE,CAAC;IAEnB,CAAC;IACD,OAAO,KAAK,CAAC;AACf,CAAC,CAAA,CAAC;AAVW,QAAA,eAAe,mBAU1B;AAEK,MAAM,eAAe,GAAG,CAAO,EAAkB,EAAE,EAAE;IAC1D,MAAM,KAAK,GAAG,MAAM,eAAe,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;IACxD,IAAI,KAAK,EAAE,CAAC;QACV,eAAK,CAAC,QAAQ,EAAE,CAAC;IAEnB,CAAC;IACD,OAAO,KAAK,CAAC;AACf,CAAC,CAAA,CAAC;AAPW,QAAA,eAAe,mBAO1B;AAEK,MAAM,cAAc,GAAG,CAC5B,OAAuB,EACvB,MAAsB,EACtB,EAAE;IACF,MAAM,KAAK,GAAG,MAAM,eAAe,CAAC,cAAc,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;IACpE,IAAI,KAAK,EAAE,CAAC;QACV,eAAK,CAAC,QAAQ,EAAE,CAAC;IAEnB,CAAC;IACD,OAAO,KAAK,CAAC;AACf,CAAC,CAAA,CAAC;AAVW,QAAA,cAAc,kBAUzB","debug_id":"1bf47f8d-8044-545b-abea-7383dbe5a788"}