{"version":3,"file":"publisherService.js","sources":["services/publisherService.ts"],"sourceRoot":"/","sourcesContent":["import { Types } from \"mongoose\";\nimport Publisher, { IPublisher } from \"../models/publisherModel\";\nimport * as PublisherRepository from \"../repositories/publisherRepository\";\nimport cache, { CACHE_TTL_SECONDS } from \"../utils/cache\";\n\nexport const createPublisher = async (publisherData: Partial<IPublisher>) => {\n  const publisher = await PublisherRepository.createPublisher(publisherData);\n  cache.flushAll();\n  return publisher;\n};\n\nexport const getPublisherById = async (\n  id: Types.ObjectId\n): Promise<IPublisher | null> => {\n  const cacheKey = `publisher_${id.toString()}`;\n  let publisher = cache.get<IPublisher | null>(cacheKey);\n\n  if (publisher === undefined) {\n    publisher = await PublisherRepository.getPublisherById(id);\n    if (publisher) {\n      cache.set(cacheKey, publisher, CACHE_TTL_SECONDS);\n    }\n  }\n\n  return publisher;\n};\n\nexport const getAllPublishers = async (\n  filter: Record<string, any>,\n  page: number,\n  limit: number,\n  sort: Record<string, \"asc\" | \"desc\">\n): Promise<IPublisher[]> => {\n  const cacheKey = `allPublishers_${JSON.stringify({\n    filter,\n    page,\n    limit,\n    sort,\n  })}`;\n  let publishers = cache.get<IPublisher[]>(cacheKey);\n\n  if (!publishers) {\n    publishers = await PublisherRepository.getAllPublishers(\n      filter,\n      page,\n      limit,\n      sort\n    );\n    cache.set(cacheKey, publishers, CACHE_TTL_SECONDS);\n  }\n\n  return publishers;\n};\n\nexport const updatePublisherById = async (\n  id: Types.ObjectId,\n  updateData: Partial<IPublisher>\n) => {\n  const publisher = await PublisherRepository.updatePublisherById(\n    id,\n    updateData\n  );\n  if (publisher) {\n    cache.flushAll();\n  }\n  return publisher;\n};\n\nexport const deletePublisherById = async (id: Types.ObjectId) => {\n  const deletedPublisher = await PublisherRepository.deletePublisherById(id);\n  cache.flushAll();\n  return deletedPublisher;\n};\n\nexport const addBookToPublisher = async (\n  publisherId: Types.ObjectId,\n  bookId: Types.ObjectId\n) => {\n  const publisher = await Publisher.findByIdAndUpdate(\n    publisherId,\n    { $push: { books: bookId } },\n    { new: true }\n  ).populate(\"books\");\n  if (publisher) {\n    cache.flushAll();\n  }\n  return publisher;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,8EAAiE;AACjE,yFAA2E;AAC3E,wDAA0D;AAEnD,MAAM,eAAe,GAAG,CAAO,aAAkC,EAAE,EAAE;IAC1E,MAAM,SAAS,GAAG,MAAM,mBAAmB,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC;IAC3E,eAAK,CAAC,QAAQ,EAAE,CAAC;IACjB,OAAO,SAAS,CAAC;AACnB,CAAC,CAAA,CAAC;AAJW,QAAA,eAAe,mBAI1B;AAEK,MAAM,gBAAgB,GAAG,CAC9B,EAAkB,EACU,EAAE;IAC9B,MAAM,QAAQ,GAAG,aAAa,EAAE,CAAC,QAAQ,EAAE,EAAE,CAAC;IAC9C,IAAI,SAAS,GAAG,eAAK,CAAC,GAAG,CAAoB,QAAQ,CAAC,CAAC;IAEvD,IAAI,SAAS,KAAK,SAAS,EAAE,CAAC;QAC5B,SAAS,GAAG,MAAM,mBAAmB,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAC;QAC3D,IAAI,SAAS,EAAE,CAAC;YACd,eAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,SAAS,EAAE,yBAAiB,CAAC,CAAC;QACpD,CAAC;IACH,CAAC;IAED,OAAO,SAAS,CAAC;AACnB,CAAC,CAAA,CAAC;AAdW,QAAA,gBAAgB,oBAc3B;AAEK,MAAM,gBAAgB,GAAG,CAC9B,MAA2B,EAC3B,IAAY,EACZ,KAAa,EACb,IAAoC,EACb,EAAE;IACzB,MAAM,QAAQ,GAAG,iBAAiB,IAAI,CAAC,SAAS,CAAC;QAC/C,MAAM;QACN,IAAI;QACJ,KAAK;QACL,IAAI;KACL,CAAC,EAAE,CAAC;IACL,IAAI,UAAU,GAAG,eAAK,CAAC,GAAG,CAAe,QAAQ,CAAC,CAAC;IAEnD,IAAI,CAAC,UAAU,EAAE,CAAC;QAChB,UAAU,GAAG,MAAM,mBAAmB,CAAC,gBAAgB,CACrD,MAAM,EACN,IAAI,EACJ,KAAK,EACL,IAAI,CACL,CAAC;QACF,eAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,UAAU,EAAE,yBAAiB,CAAC,CAAC;IACrD,CAAC;IAED,OAAO,UAAU,CAAC;AACpB,CAAC,CAAA,CAAC;AAzBW,QAAA,gBAAgB,oBAyB3B;AAEK,MAAM,mBAAmB,GAAG,CACjC,EAAkB,EAClB,UAA+B,EAC/B,EAAE;IACF,MAAM,SAAS,GAAG,MAAM,mBAAmB,CAAC,mBAAmB,CAC7D,EAAE,EACF,UAAU,CACX,CAAC;IACF,IAAI,SAAS,EAAE,CAAC;QACd,eAAK,CAAC,QAAQ,EAAE,CAAC;IACnB,CAAC;IACD,OAAO,SAAS,CAAC;AACnB,CAAC,CAAA,CAAC;AAZW,QAAA,mBAAmB,uBAY9B;AAEK,MAAM,mBAAmB,GAAG,CAAO,EAAkB,EAAE,EAAE;IAC9D,MAAM,gBAAgB,GAAG,MAAM,mBAAmB,CAAC,mBAAmB,CAAC,EAAE,CAAC,CAAC;IAC3E,eAAK,CAAC,QAAQ,EAAE,CAAC;IACjB,OAAO,gBAAgB,CAAC;AAC1B,CAAC,CAAA,CAAC;AAJW,QAAA,mBAAmB,uBAI9B;AAEK,MAAM,kBAAkB,GAAG,CAChC,WAA2B,EAC3B,MAAsB,EACtB,EAAE;IACF,MAAM,SAAS,GAAG,MAAM,wBAAS,CAAC,iBAAiB,CACjD,WAAW,EACX,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE,EAC5B,EAAE,GAAG,EAAE,IAAI,EAAE,CACd,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;IACpB,IAAI,SAAS,EAAE,CAAC;QACd,eAAK,CAAC,QAAQ,EAAE,CAAC;IACnB,CAAC;IACD,OAAO,SAAS,CAAC;AACnB,CAAC,CAAA,CAAC;AAbW,QAAA,kBAAkB,sBAa7B","debug_id":"801629a9-94c1-5978-945a-c5f4c1c813fd"}